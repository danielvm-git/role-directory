# Story 2.6: Environment-Specific Database Configuration Documentation

Status: drafted

## Story

As a **developer**,  
I want **clear documentation for configuring database connections in each environment**,  
so that **I can quickly troubleshoot connection issues and onboard new contributors**.

## Acceptance Criteria

**Given** all three environments are set up  
**When** I reference the documentation  
**Then** it includes:
- How to obtain Neon connection strings from Neon Console
- How to store connection strings in Google Secret Manager
- How to inject secrets into Cloud Run services
- Format of `DATABASE_URL` environment variable
- Troubleshooting common connection issues (cold starts, timeouts, SSL)
- How to test database connectivity locally
- How to run migrations against each environment

**And** documentation includes examples and screenshots where helpful  
**And** security best practices are noted (never commit connection strings)  
**And** documentation is located in README or `docs/neon-infrastructure-setup-guide.md`

## Tasks / Subtasks

- [ ] Task 1: Create comprehensive Neon setup guide (AC: Step-by-step Neon documentation exists)
  - [ ] Create `docs/guides/neon-infrastructure-setup-guide.md`
  - [ ] Add document header:
    - Title: "Neon PostgreSQL Infrastructure Setup Guide"
    - Author: danielvm
    - Date: 2025-11-06
    - Purpose: Complete guide for setting up Neon databases across all environments
  - [ ] Add table of contents with all major sections
  - [ ] Use clear headings and structured format

- [ ] Task 2: Document Neon account and project setup (AC: Neon account setup documented)
  - [ ] Add section: "1. Neon Account Setup"
  - [ ] Document prerequisites:
    - Valid email address
    - GitHub account (for OAuth sign-in)
  - [ ] Step-by-step Neon account creation:
    1. Visit https://neon.tech
    2. Click "Sign Up" or "Get Started"
    3. Sign in with GitHub (recommended) or email
    4. Verify email if using email sign-up
    5. Complete onboarding wizard
  - [ ] Document Neon free tier limits:
    - 1 project
    - 3GB storage
    - 100 compute hours/month
    - Auto-suspend after 5 minutes of inactivity
    - PostgreSQL 17.0
  - [ ] Add screenshots (optional but helpful):
    - Neon sign-up page
    - Account dashboard

- [ ] Task 3: Document database creation for all three environments (AC: Database creation steps documented)
  - [ ] Add section: "2. Create Databases for Each Environment"
  - [ ] Document decision: Single project with 3 databases vs 3 separate projects
    - **Recommended**: 3 databases in one project (simpler, within free tier)
  - [ ] Step-by-step database creation:
    1. Navigate to Neon Console (https://console.neon.tech)
    2. Select project (or create new project: "role-directory")
    3. Create database: `role_directory_dev`
       - Click "Databases" in left sidebar
       - Click "New Database"
       - Name: `role_directory_dev`
       - Click "Create"
    4. Repeat for staging: `role_directory_stg`
    5. Repeat for production: `role_directory_prd`
  - [ ] Document expected result: 3 databases visible in Neon Console
  - [ ] Add screenshot: Neon Console database list showing all 3 databases

- [ ] Task 4: Document connection string retrieval (AC: Connection string format documented)
  - [ ] Add section: "3. Obtain Connection Strings"
  - [ ] Document how to find connection strings:
    1. In Neon Console, select database (e.g., `role_directory_dev`)
    2. Click "Connection Details" or "Connect"
    3. Copy connection string (PostgreSQL format)
  - [ ] Document connection string format:
    ```
    postgresql://[user]:[password]@[host]/[database]?sslmode=require
    
    Example:
    postgresql://daniel_user:AbCd1234EfGh@ep-cool-meadow-123456.us-east-2.aws.neon.tech/role_directory_dev?sslmode=require
    ```
  - [ ] Document connection string components:
    - **user**: Database user (auto-generated by Neon)
    - **password**: Database password (auto-generated, rotate if compromised)
    - **host**: Neon endpoint (format: `ep-[adjective]-[noun]-[id].[region].aws.neon.tech`)
    - **database**: Database name (e.g., `role_directory_dev`)
    - **sslmode**: Must be `require` (enforce TLS/SSL)
  - [ ] **Security Warning**: Never commit connection strings to git
  - [ ] Document connection string locations (where to store):
    - Local development: `.env.local` (gitignored)
    - CI/CD: GitHub Secrets
    - Cloud Run: Google Secret Manager
  - [ ] Add screenshot: Neon Console showing connection string copy button

- [ ] Task 5: Document Google Secret Manager setup (AC: Secret Manager configuration documented)
  - [ ] Add section: "4. Store Connection Strings in Google Secret Manager"
  - [ ] Document why use Secret Manager:
    - Secure storage for sensitive credentials
    - Runtime injection into Cloud Run (no hardcoding)
    - Rotation support (update secret without redeploying)
    - Audit logging (who accessed secrets when)
    - Free tier: 6 secrets at no cost
  - [ ] Step-by-step Secret Manager setup:
    1. Enable Secret Manager API:
       ```bash
       gcloud services enable secretmanager.googleapis.com
       ```
    2. Create secret for dev database:
       ```bash
       echo -n "postgresql://user:pass@ep-xxx.neon.tech/role_directory_dev?sslmode=require" | \
       gcloud secrets create role-directory-dev-db-url \
         --data-file=- \
         --replication-policy="automatic"
       ```
    3. Repeat for staging:
       ```bash
       echo -n "postgresql://user:pass@ep-xxx.neon.tech/role_directory_stg?sslmode=require" | \
       gcloud secrets create role-directory-stg-db-url \
         --data-file=- \
         --replication-policy="automatic"
       ```
    4. Repeat for production:
       ```bash
       echo -n "postgresql://user:pass@ep-xxx.neon.tech/role_directory_prd?sslmode=require" | \
       gcloud secrets create role-directory-prd-db-url \
         --data-file=- \
         --replication-policy="automatic"
       ```
  - [ ] Document how to verify secrets created:
    ```bash
    gcloud secrets list
    ```
  - [ ] Expected output: 3 secrets listed (dev, stg, prd database URLs)
  - [ ] Document how to update a secret (if needed):
    ```bash
    echo -n "NEW_CONNECTION_STRING" | \
    gcloud secrets versions add role-directory-dev-db-url --data-file=-
    ```

- [ ] Task 6: Document Cloud Run IAM permissions (AC: IAM setup documented)
  - [ ] Add section: "5. Grant Cloud Run Access to Secrets"
  - [ ] Document IAM requirement:
    - Cloud Run service account needs `roles/secretmanager.secretAccessor`
    - This allows Cloud Run to read secrets at runtime
  - [ ] Step-by-step IAM grant:
    1. Get Cloud Run service account email:
       ```bash
       gcloud run services describe role-directory-dev \
         --region=us-central1 \
         --format='value(spec.template.spec.serviceAccountName)'
       ```
       If empty, uses default: `PROJECT_NUMBER-compute@developer.gserviceaccount.com`
    2. Grant access to dev secret:
       ```bash
       gcloud secrets add-iam-policy-binding role-directory-dev-db-url \
         --member="serviceAccount:PROJECT_NUMBER-compute@developer.gserviceaccount.com" \
         --role="roles/secretmanager.secretAccessor"
       ```
    3. Repeat for staging and production secrets
  - [ ] Document how to find PROJECT_NUMBER:
    ```bash
    gcloud projects describe PROJECT_ID --format='value(projectNumber)'
    ```
  - [ ] Document verification:
    ```bash
    gcloud secrets get-iam-policy role-directory-dev-db-url
    ```
    Expected: Service account listed with `secretAccessor` role

- [ ] Task 7: Document Cloud Run secret injection (AC: Cloud Run configuration documented)
  - [ ] Add section: "6. Inject Secrets into Cloud Run Services"
  - [ ] Document secret injection command:
    ```bash
    # Dev environment
    gcloud run services update role-directory-dev \
      --region=us-central1 \
      --set-secrets=DATABASE_URL=role-directory-dev-db-url:latest
    
    # Staging environment
    gcloud run services update role-directory-stg \
      --region=us-central1 \
      --set-secrets=DATABASE_URL=role-directory-stg-db-url:latest
    
    # Production environment
    gcloud run services update role-directory-prd \
      --region=us-central1 \
      --set-secrets=DATABASE_URL=role-directory-prd-db-url:latest
    ```
  - [ ] Document secret versioning:
    - `latest` always uses newest secret version
    - Can pin to specific version: `role-directory-dev-db-url:3`
    - Recommended: Use `latest` for automatic rotation
  - [ ] Document verification:
    ```bash
    gcloud run services describe role-directory-dev \
      --region=us-central1 \
      --format='yaml(spec.template.spec.containers[0].env)'
    ```
    Expected: `DATABASE_URL` with secret reference
  - [ ] Document deployment trigger:
    - Updating secrets creates new revision
    - Traffic automatically routed to new revision
    - Old revision remains available for rollback

- [ ] Task 8: Document local development setup (AC: Local dev database configuration documented)
  - [ ] Add section: "7. Local Development Configuration"
  - [ ] Document `.env.local` setup:
    1. Copy `.env.example` to `.env.local`:
       ```bash
       cp .env.example .env.local
       ```
    2. Edit `.env.local` and add dev database connection string:
       ```bash
       DATABASE_URL="postgresql://user:pass@ep-xxx.neon.tech/role_directory_dev?sslmode=require"
       NODE_ENV="development"
       PORT="3000"
       ALLOWED_EMAILS="your-email@example.com"
       ```
    3. Verify `.env.local` is in `.gitignore`
  - [ ] Document testing local connection:
    ```bash
    npm run dev
    # Visit http://localhost:3000/api/health
    # Should return: { "status": "ok", "database": "connected" }
    ```
  - [ ] **Security Warning**: Never commit `.env.local` to git
  - [ ] Document `.env.example` template (reference only, no real credentials):
    ```bash
    DATABASE_URL="postgresql://user:password@host/database?sslmode=require"
    NODE_ENV="development"
    PORT="3000"
    ALLOWED_EMAILS="email1@example.com,email2@example.com"
    ```

- [ ] Task 9: Document database migration workflow (AC: Migration process documented)
  - [ ] Add section: "8. Running Database Migrations"
  - [ ] Document migration commands:
    ```bash
    # Check migration status
    npm run migrate:status
    
    # Apply pending migrations
    npm run migrate:up
    
    # Rollback last migration
    npm run migrate:down
    
    # Create new migration
    npm run migrate:create -- migration_name
    ```
  - [ ] Document migration workflow per environment:
    **Development:**
    ```bash
    export DATABASE_URL="postgresql://..."  # Dev connection string
    npm run migrate:status
    npm run migrate:up
    ```
    
    **Staging:**
    ```bash
    export DATABASE_URL="postgresql://..."  # Staging connection string
    npm run migrate:status
    npm run migrate:up
    ```
    
    **Production:**
    ```bash
    export DATABASE_URL="postgresql://..."  # Production connection string
    npm run migrate:status
    npm run migrate:up
    ```
  - [ ] Document migration best practices:
    1. Test migration in dev first
    2. Apply to staging for validation
    3. Apply to production only after staging verification
    4. Always have rollback plan ready
    5. Backup production database before major migrations
  - [ ] Document migration verification:
    ```bash
    # Check applied migrations
    psql $DATABASE_URL -c "SELECT * FROM schema_migrations ORDER BY applied_at"
    
    # Check table list
    psql $DATABASE_URL -c "\dt"
    ```

- [ ] Task 10: Document connection testing with psql (AC: Connection testing documented)
  - [ ] Add section: "9. Testing Database Connectivity"
  - [ ] Document psql installation:
    - macOS: `brew install postgresql`
    - Ubuntu/Debian: `sudo apt install postgresql-client`
    - Windows: Download from postgresql.org
  - [ ] Document connection test commands:
    ```bash
    # Test dev database
    psql "postgresql://user:pass@ep-xxx.neon.tech/role_directory_dev?sslmode=require"
    
    # Or using environment variable
    export DATABASE_URL="postgresql://..."
    psql $DATABASE_URL
    ```
  - [ ] Document successful connection indicators:
    - Prompt changes to: `role_directory_dev=>`
    - No connection errors
  - [ ] Document useful psql commands:
    ```sql
    -- List all databases
    \l
    
    -- List all tables
    \dt
    
    -- Describe table structure
    \d table_name
    
    -- Show PostgreSQL version
    SELECT version();
    
    -- Test simple query
    SELECT 1;
    
    -- Exit psql
    \q
    ```
  - [ ] Document connection troubleshooting:
    - Error: "could not connect to server" → Check host, firewall, Neon status
    - Error: "password authentication failed" → Verify password in connection string
    - Error: "SSL connection required" → Ensure `?sslmode=require` in connection string

- [ ] Task 11: Document common troubleshooting scenarios (AC: Troubleshooting guide exists)
  - [ ] Add section: "10. Troubleshooting"
  - [ ] Document common issues and solutions:
    
    **Issue 1: "Connection timeout" or "Connection refused"**
    - **Cause**: Neon database suspended (cold start)
    - **Solution**: Wait 2-3 seconds for Neon to auto-resume
    - **Prevention**: Neon free tier auto-suspends after 5 minutes
    
    **Issue 2: "Password authentication failed"**
    - **Cause**: Incorrect password in DATABASE_URL
    - **Solution**: 
      1. Reset password in Neon Console (Database → Settings → Reset Password)
      2. Update connection string in Secret Manager or .env.local
      3. Redeploy Cloud Run service (if secret updated)
    
    **Issue 3: "SSL connection required"**
    - **Cause**: Missing `?sslmode=require` in connection string
    - **Solution**: Add `?sslmode=require` to end of DATABASE_URL
    - **Example**: `postgresql://...@host/db?sslmode=require`
    
    **Issue 4: "Secret not found" in Cloud Run**
    - **Cause**: Secret not created or IAM permissions missing
    - **Solution**:
      1. Verify secret exists: `gcloud secrets list`
      2. Check IAM binding: `gcloud secrets get-iam-policy SECRET_NAME`
      3. Grant access if missing (see section 5)
    
    **Issue 5: "Health check fails with database: disconnected"**
    - **Cause**: DATABASE_URL not injected or incorrect
    - **Solution**:
      1. Check Cloud Run env vars: `gcloud run services describe SERVICE_NAME`
      2. Verify secret exists and has correct value
      3. Check Cloud Run logs for connection errors
    
    **Issue 6: "Query timeout" (>2 seconds)**
    - **Cause**: Neon cold start or network latency
    - **Solution**: 
      - Normal on first request after suspend (2-3 seconds)
      - Check Cloud Run region vs Neon region (latency)
      - Consider Neon paid tier for always-on compute
    
    **Issue 7: "Too many connections"**
    - **Cause**: Connection pool exhausted (unlikely with Neon driver)
    - **Solution**: 
      - Verify using `@neondatabase/serverless` driver (has built-in pooling)
      - Check for connection leaks in application code
      - Neon free tier limit: 100 concurrent connections
  - [ ] Document where to find logs:
    ```bash
    # Cloud Run logs
    gcloud logging read "resource.type=cloud_run_revision \
      AND resource.labels.service_name=role-directory-dev" \
      --limit=50 \
      --format=json
    
    # Filter for database errors
    gcloud logging read "resource.type=cloud_run_revision \
      AND jsonPayload.message=~'\\[DB\\]'" \
      --limit=20
    ```

- [ ] Task 12: Document security best practices (AC: Security guidelines documented)
  - [ ] Add section: "11. Security Best Practices"
  - [ ] Document security guidelines:
    1. **Never commit DATABASE_URL to git**
       - Always use `.env.local` (gitignored)
       - Use Secret Manager for Cloud Run
       - Use GitHub Secrets for CI/CD
    
    2. **Use parameterized queries only**
       - Always: `query('SELECT * FROM users WHERE id = $1', [userId])`
       - Never: `query('SELECT * FROM users WHERE id = ' + userId)`
       - Prevents SQL injection attacks
    
    3. **Enforce SSL/TLS encryption**
       - Always include `?sslmode=require` in DATABASE_URL
       - Neon enforces encryption by default
    
    4. **Rotate credentials regularly**
       - Reset Neon password periodically
       - Update Secret Manager with new password
       - Redeploy Cloud Run services
    
    5. **Use least privilege access**
       - Cloud Run service account: Only `secretAccessor` role
       - Database user: Only necessary table permissions
    
    6. **Monitor access logs**
       - Review Secret Manager audit logs
       - Monitor Cloud Run logs for suspicious activity
       - Set up alerts for authentication failures
    
    7. **Separate databases per environment**
       - Dev, staging, production use different databases
       - Never use production credentials in dev/staging
       - Different passwords for each environment

- [ ] Task 13: Add quick reference section (AC: Quick reference guide exists)
  - [ ] Add section: "12. Quick Reference"
  - [ ] Create table of common commands:
    
    | Task | Command |
    |------|---------|
    | **List secrets** | `gcloud secrets list` |
    | **Create secret** | `echo -n "value" \| gcloud secrets create NAME --data-file=-` |
    | **Update secret** | `echo -n "new_value" \| gcloud secrets versions add NAME --data-file=-` |
    | **View secret value** | `gcloud secrets versions access latest --secret=NAME` |
    | **Grant Cloud Run access** | `gcloud secrets add-iam-policy-binding NAME --member="serviceAccount:SA_EMAIL" --role="roles/secretmanager.secretAccessor"` |
    | **Update Cloud Run secret** | `gcloud run services update SERVICE --set-secrets=DATABASE_URL=SECRET_NAME:latest` |
    | **Test database connection** | `psql $DATABASE_URL` |
    | **Run migrations** | `npm run migrate:up` |
    | **Check migration status** | `npm run migrate:status` |
    | **Health check** | `curl https://SERVICE_URL/api/health` |
  
  - [ ] Add connection string template:
    ```bash
    # Format
    postgresql://[USER]:[PASSWORD]@[HOST]/[DATABASE]?sslmode=require
    
    # Dev
    postgresql://user:pass@ep-xxx.us-east-2.aws.neon.tech/role_directory_dev?sslmode=require
    
    # Staging
    postgresql://user:pass@ep-xxx.us-east-2.aws.neon.tech/role_directory_stg?sslmode=require
    
    # Production
    postgresql://user:pass@ep-xxx.us-east-2.aws.neon.tech/role_directory_prd?sslmode=require
    ```

- [ ] Task 14: Update README with database setup reference (AC: README references database docs)
  - [ ] Open `README.md`
  - [ ] Add section: "Database Setup" (if not exists)
  - [ ] Add concise summary:
    ```markdown
    ## Database Setup
    
    role-directory uses Neon PostgreSQL (serverless) with three separate databases:
    - `role_directory_dev` - Development environment
    - `role_directory_stg` - Staging environment
    - `role_directory_prd` - Production environment
    
    **Quick Setup:**
    1. Create Neon account: https://neon.tech
    2. Create 3 databases (see guide below)
    3. Store connection strings in Google Secret Manager
    4. Configure local development with .env.local
    
    **Full Setup Guide:** [docs/guides/neon-infrastructure-setup-guide.md](docs/guides/neon-infrastructure-setup-guide.md)
    
    **Local Development:**
    ```bash
    cp .env.example .env.local
    # Edit .env.local with your dev database URL
    npm run dev
    ```
    ```
  - [ ] Add to "Environment Variables" section:
    ```markdown
    | Variable | Description | Example |
    |----------|-------------|---------|
    | `DATABASE_URL` | PostgreSQL connection string (Neon) | `postgresql://user:pass@ep-xxx.neon.tech/db?sslmode=require` |
    | `NODE_ENV` | Environment (development, staging, production) | `development` |
    | `PORT` | Server port (Cloud Run uses 8080) | `8080` |
    | `ALLOWED_EMAILS` | Comma-separated email whitelist | `email1@example.com,email2@example.com` |
    ```

- [ ] Task 15: Create or update .env.example (AC: Environment variable template exists)
  - [ ] Create `.env.example` in project root (if not exists)
  - [ ] Add database configuration template:
    ```bash
    # Database Configuration (Neon PostgreSQL)
    # DO NOT COMMIT REAL CREDENTIALS - This is a template file
    DATABASE_URL="postgresql://user:password@ep-example.us-east-2.aws.neon.tech/role_directory_dev?sslmode=require"
    
    # Application Configuration
    NODE_ENV="development"
    PORT="3000"
    
    # Authentication Configuration (Epic 3)
    NEON_AUTH_PROJECT_ID="your-neon-auth-project-id"
    NEON_AUTH_SECRET_KEY="your-neon-auth-secret-key"
    ALLOWED_EMAILS="email1@example.com,email2@example.com"
    
    # Runtime Configuration
    NEXT_PUBLIC_API_URL="http://localhost:3000"
    ```
  - [ ] Add comments explaining each variable
  - [ ] Use placeholder values (not real credentials)
  - [ ] Ensure `.env.example` is committed to git
  - [ ] Ensure `.env.local` is in `.gitignore`

- [ ] Task 16: Review and finalize documentation (AC: Documentation complete and accurate)
  - [ ] Review all documentation for accuracy:
    - Command syntax correct
    - Paths and filenames correct
    - Examples work as written
    - No sensitive data exposed
  - [ ] Check documentation structure:
    - Logical flow (account setup → databases → secrets → deployment)
    - Clear headings and sections
    - Table of contents accurate
  - [ ] Spell check and grammar review
  - [ ] Add helpful notes and tips throughout
  - [ ] Include links to official documentation:
    - Neon docs: https://neon.tech/docs
    - GCP Secret Manager: https://cloud.google.com/secret-manager/docs
    - Cloud Run: https://cloud.google.com/run/docs
  - [ ] Add "Last Updated" date at top of document
  - [ ] Mark document status: "Complete - Epic 2"

## Dev Notes

### Technical Context

**Architecture References:**
- **Epic 2 Tech Spec**: Documentation requirements
- **Story 2.1**: Neon database setup (now documented)
- **Story 2.2**: Configuration module (documented patterns)
- **Story 2.3**: Migration system (documented commands)
- **Story 2.5**: Health check with database (documented verification)
- **Architecture**: Security patterns, environment configuration

**Key Documentation Sections:**

1. **Neon Account Setup** - Account creation, free tier limits
2. **Database Creation** - Creating 3 databases (dev, stg, prd)
3. **Connection Strings** - Format, components, security
4. **Secret Manager** - Storing credentials securely
5. **IAM Permissions** - Granting Cloud Run access
6. **Cloud Run Injection** - Injecting secrets as env vars
7. **Local Development** - .env.local setup
8. **Migrations** - Running migrations per environment
9. **Connection Testing** - Using psql to verify connectivity
10. **Troubleshooting** - Common issues and solutions
11. **Security** - Best practices for credentials
12. **Quick Reference** - Command cheat sheet

**Documentation Goals:**
- ✅ Enable new developers to set up database in <30 minutes
- ✅ Provide clear troubleshooting for common issues
- ✅ Document security best practices prominently
- ✅ Include working examples for all commands
- ✅ Reference official documentation for deeper learning

### Project Structure Notes

**Files Created/Modified:**
```
role-directory/
├── docs/
│   └── guides/
│       └── neon-infrastructure-setup-guide.md    # NEW: Comprehensive setup guide
├── .env.example                                  # NEW or MODIFIED: Env var template
└── README.md                                     # MODIFIED: Add database setup section
```

**Documentation Organization:**
- Primary guide: `docs/guides/neon-infrastructure-setup-guide.md`
- Quick reference: README.md
- Environment template: `.env.example`

### Testing Standards Summary

**For This Story:**
- **Manual Verification**: Follow documentation to verify accuracy
- **New Developer Test**: Have someone unfamiliar with project follow docs
- **Command Testing**: Test all commands work as documented

**Verification Checklist:**
1. ✅ All commands execute successfully
2. ✅ Connection string format correct
3. ✅ Secret Manager commands work
4. ✅ IAM permissions grant access correctly
5. ✅ Cloud Run secret injection works
6. ✅ Local development setup functional
7. ✅ Migration commands work per environment
8. ✅ Troubleshooting guide addresses real issues encountered

**Expected Results:**
- Comprehensive documentation for entire database setup
- Clear troubleshooting guide for common issues
- Security best practices prominently featured
- New developers can set up database independently

### Constraints and Patterns

**MUST Follow:**

1. **Security First** (architecture.md):
   - ✅ Emphasize "never commit credentials"
   - ✅ Document Secret Manager prominently
   - ✅ Show parameterized queries examples
   - ✅ Document SSL/TLS requirements

2. **Clarity and Completeness** (Epic 2 Tech Spec):
   - ✅ Step-by-step instructions
   - ✅ Working examples for all commands
   - ✅ Screenshots where helpful
   - ✅ Links to official documentation

3. **Environment Separation** (architecture.md):
   - ✅ Document 3 separate databases
   - ✅ Document different credentials per environment
   - ✅ Emphasize no production credentials in dev/staging

4. **Troubleshooting Focus** (Epic 2 Tech Spec):
   - ✅ Document common issues from actual experience
   - ✅ Provide clear solutions with commands
   - ✅ Include log locations for debugging
   - ✅ Reference health check for verification

### References

- [Source: docs/2-planning/epics.md#Story-2.6] - Story definition and acceptance criteria
- [Source: docs/tech-spec-epic-2.md#Documentation] - Technical specification
- [Source: docs/3-solutioning/architecture.md#Security] - Security patterns
- [Source: docs/stories/2-1-neon-postgresql-account-and-database-setup.md] - Neon setup (Story 2.1)
- [Source: docs/stories/2-5-database-connection-testing-in-health-check.md] - Health check verification (Story 2.5)

### Learnings from Previous Story

**From Story 2-5 (Database Connection Testing in Health Check) (Status: drafted):**
- Story 2-5 not yet implemented - no completion learnings available
- Will incorporate learnings once Story 2-5 is completed

**Expected Dependencies from Previous Stories:**
- ✅ Story 2.1 (drafted): Neon databases created (process to document)
- ✅ Story 2.2 (drafted): Configuration module (patterns to reference)
- ✅ Story 2.3 (drafted): Migration system (commands to document)
- ✅ Story 2.4 (drafted): Initial schema migration (migration workflow example)
- ✅ Story 2.5 (drafted): Health check with database (verification method)

**Assumptions:**
- All previous Epic 2 stories completed (database setup functional)
- Developer has experienced real setup process (knows pain points)
- Common issues encountered during setup (documented in troubleshooting)
- Security concerns identified and addressed in documentation

**Important Notes:**
- This is the **final story in Epic 2** (documentation and cleanup)
- Documentation should reflect **actual implementation** from Stories 2.1-2.5
- Include **real troubleshooting** from issues encountered during setup
- Emphasize **security best practices** throughout documentation
- Documentation should enable **independent setup** by new developers
- Next epic (Epic 3) will build on this foundation with authentication

## Dev Agent Record

### Context Reference

<!-- Path(s) to story context XML will be added here by context workflow -->

### Agent Model Used

<!-- Fill in when implementing: e.g., Claude Sonnet 4.5 -->

### Debug Log References

<!-- Add links to debug logs or issues encountered during implementation -->

### Completion Notes List

<!-- Dev agent fills in after completing story:
- New patterns/services created
- Architectural deviations or decisions made
- Technical debt deferred to future stories
- Warnings or recommendations for next story
- Interfaces/methods created for reuse
-->

### File List

<!-- Dev agent fills in after completing story:
Format: [STATUS] path/to/file.ext
- NEW: file created
- MODIFIED: file changed
- DELETED: file removed
-->

## Change Log

| Date | Author | Changes |
|------|--------|---------|
| 2025-11-06 | danielvm (SM - Bob) | Initial story creation from epics.md |

